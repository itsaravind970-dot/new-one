<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-content" />
    <title>bapkam.ai</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ¤–</text></svg>" />
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { 
                sans: ['Inter', 'sans-serif'],
                mono: ['Fira Code', 'monospace']
            },
            animation: { 
                'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                'fade-in-up': 'fadeInUp 0.5s ease-out forwards',
                'fade-in': 'fadeIn 0.3s ease-out forwards',
                'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            },
            keyframes: {
                fadeInUp: {
                    '0%': { opacity: '0', transform: 'translateY(20px)' },
                    '100%': { opacity: '1', transform: 'translateY(0)' },
                },
                fadeIn: {
                    '0%': { opacity: '0' },
                    '100%': { opacity: '1' },
                }
            }
          }
        }
      }
    </script>
    
    <!-- React Dependencies -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script>
        // Suppress the Babel "production" warning
        const originalWarn = console.warn;
        console.warn = function(...args) {
            if (args[0] && typeof args[0] === 'string' && args[0].includes('in-browser Babel transformer')) return;
            originalWarn.apply(console, args);
        };
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Mobile App-like Layout Fixes */
        html, body { height: 100%; margin: 0; overflow: hidden; background-color: #ffffff; overscroll-behavior: none; }
        #root { position: fixed; inset: 0; height: 100dvh; width: 100vw; display: flex; flex-direction: column; z-index: 1; }
        
        /* Scrollbar Polish */
        .custom-scroll::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* Mobile Tap Highlight Removal */
        * { -webkit-tap-highlight-color: transparent; }
        
        /* Glassmorphism Utilities */
        .glass { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); }

        /* Code Syntax Highlighting Tokens */
        .token-keyword { color: #c678dd; font-weight: bold; } /* Purple */
        .token-string { color: #98c379; } /* Green */
        .token-comment { color: #5c6370; font-style: italic; } /* Grey */
        .token-function { color: #61afef; } /* Blue */
        .token-number { color: #d19a66; } /* Orange */
        .token-operator { color: #56b6c2; } /* Cyan */
    </style>
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.30.0",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/"
  }
}
</script>
</head>
  <body>
    <div id="root"></div>

    <script type="text/babel" data-presets="typescript,react">
      const { useState, useEffect, useRef, useCallback } = React;

      // --- ICONS ---
      const Icon = ({ d, className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d={d}/></svg>;
      const SendIcon = (p) => <Icon d="M22 2 11 13M22 2l-7 20-4-9-9-4 20-7" {...p} />;
      const MenuIcon = (p) => <Icon d="M4 6h16M4 12h16M4 18h16" {...p} />;
      const PlusIcon = (p) => <Icon d="M12 5v14M5 12h14" {...p} />;
      const CloseIcon = (p) => <Icon d="M18 6 6 18M6 6l12 12" {...p} />;
      const SearchIcon = (p) => <Icon d="M11 19a8 8 0 1 0 0-16 8 8 0 0 0 0 16zM21 21l-4.35-4.35" {...p} />;
      const ImageUploadIcon = (p) => <Icon d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7m4 0h6m-3-3v6" {...p} />; 
      const CodeIcon = (p) => <Icon d="M16 18 22 12 16 6M8 6 2 12 8 18" {...p} />;
      const SparklesIcon = (p) => <Icon d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" {...p} />;
      const CheckIcon = (p) => <Icon d="M20 6 9 17l-5-5" {...p} />;
      const CopyIcon = (p) => <Icon d="M8 4v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7.242a2 2 0 0 0-.602-1.43L16.083 2.57A2 2 0 0 0 14.685 2H10a2 2 0 0 0-2 2z M16 18v2a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h2" {...p} />;
      const ShareIcon = (p) => <Icon d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8m-4-6-4-4-4 4m4-4v13" {...p} />;
      const MicIcon = (p) => <Icon d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3zM19 10v2a7 7 0 0 1-14 0v-2M12 19v4M8 23h8" {...p} />;

      // --- API CONFIGURATION ---
      const API_KEY = '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'; 
      const API_URL = 'https://openrouter.ai/api/v1/chat/completions';
      const MODEL = 'google/gemini-2.0-flash-001';

      // --- HELPERS ---
      const getTimeBasedGreeting = () => {
          const hour = new Date().getHours();
          if (hour < 12) return "Good morning";
          if (hour < 18) return "Good afternoon";
          return "Good evening";
      };

      // Simple syntax highlighting helper
      const highlightCode = (code, language) => {
          let highlighted = code
              .replace(/&/g, "&amp;")
              .replace(/</g, "&lt;")
              .replace(/>/g, "&gt;");

          // Basic Python/JS patterns
          highlighted = highlighted
              // Strings
              .replace(/(['"`])(.*?)\1/g, '<span class="token-string">$1$2$1</span>')
              // Keywords (Python + JS mix)
              .replace(/\b(def|class|import|from|return|if|else|elif|for|while|try|except|async|await|const|let|var|function|print|console|bg|color|px|solid|border)\b/g, '<span class="token-keyword">$1</span>')
              // Functions
              .replace(/\b([a-zA-Z_][a-zA-Z0-9_]*)(?=\()/g, '<span class="token-function">$1</span>')
              // Numbers
              .replace(/\b(\d+)\b/g, '<span class="token-number">$1</span>')
              // Comments
              .replace(/(#.*|\/\/.*)$/gm, '<span class="token-comment">$1</span>');

          return highlighted;
      };

      // --- COMPONENTS ---

      const CodeBlock = ({ language, code }) => {
          const [copied, setCopied] = useState(false);

          const handleCopy = () => {
              navigator.clipboard.writeText(code);
              setCopied(true);
              setTimeout(() => setCopied(false), 2000);
          };

          const handleShare = async () => {
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'Code Snippet from bapkam.ai',
                        text: code,
                    });
                } catch (err) {
                    console.log('Share aborted');
                }
            } else {
                // Fallback for desktop or unsupported browsers
                navigator.clipboard.writeText(code);
                alert("Code copied to clipboard! You can now paste it into your social media.");
            }
          };

          return (
              <div className="my-4 rounded-xl overflow-hidden border border-slate-200 shadow-md bg-[#1e1e1e] text-slate-300 w-full max-w-full group">
                  {/* Code Header - VS Code Style */}
                  <div className="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] border-b border-[#1e1e1e]">
                      <div className="flex items-center gap-2">
                          {/* Mac-style window dots */}
                          <div className="flex gap-1.5 mr-2">
                              <div className="w-2.5 h-2.5 rounded-full bg-[#ff5f56]"></div>
                              <div className="w-2.5 h-2.5 rounded-full bg-[#ffbd2e]"></div>
                              <div className="w-2.5 h-2.5 rounded-full bg-[#27c93f]"></div>
                          </div>
                          <span className="text-xs font-mono font-medium text-slate-400 uppercase tracking-wider">
                              {language || 'CODE'}
                          </span>
                      </div>
                      <div className="flex items-center gap-2">
                          <button 
                              onClick={handleShare}
                              className="text-xs flex items-center gap-1 text-slate-400 hover:text-indigo-400 transition-colors"
                          >
                               <ShareIcon className="w-3 h-3" /> Share
                          </button>
                          <div className="w-px h-4 bg-slate-600 mx-1"></div>
                          <button 
                              onClick={handleCopy} 
                              className="flex items-center gap-1.5 text-xs font-medium text-slate-400 hover:text-white transition-colors"
                          >
                              {copied ? <CheckIcon className="w-3.5 h-3.5 text-green-400" /> : <CopyIcon className="w-3.5 h-3.5" />}
                              {copied ? 'Copied!' : 'Copy'}
                          </button>
                      </div>
                  </div>
                  {/* Code Body */}
                  <div className="relative overflow-x-auto custom-scroll p-0 bg-[#1e1e1e]">
                      <div className="flex min-w-full">
                          {/* Line Numbers */}
                          <div className="flex flex-col items-end px-3 py-4 text-right select-none bg-[#1e1e1e] text-[#4b5263] text-xs font-mono leading-6 border-r border-[#2d2d2d]">
                               {code.trim().split('\n').map((_, i) => (
                                   <span key={i}>{i + 1}</span>
                               ))}
                          </div>
                          {/* Code Content */}
                          <pre className="flex-1 px-4 py-4 text-sm font-mono leading-6 tab-4 outline-none">
                              <code 
                                dangerouslySetInnerHTML={{ __html: highlightCode(code, language) }} 
                              />
                          </pre>
                      </div>
                  </div>
              </div>
          );
      };

      const ChatMessage = ({ msg }) => {
          const isUser = msg.role === 'user';
          
          const renderContent = () => {
            if (Array.isArray(msg.content)) {
              // Handle User Multimodal (Image + Text)
              return (
                <div className="flex flex-col gap-2">
                  {msg.content.map((part, i) => {
                    if (part.type === 'image_url') {
                      return (
                        <img key={i} src={part.image_url.url} alt="Uploaded content" className="rounded-xl max-w-full h-auto border border-gray-200 shadow-sm" style={{maxHeight: '300px'}} />
                      );
                    }
                    return part.text ? <div key={i} className="whitespace-pre-wrap font-sans">{part.text}</div> : null;
                  })}
                </div>
              );
            }

            // Handle Model Response (Parsing Markdown Code Blocks)
            const rawContent = msg.content || '';
            // Split by code blocks: ```lang ... ```
            // Result array: [text, lang, code, text, lang, code...]
            const parts = rawContent.split(/```(\w+)?\n([\s\S]*?)```/g);

            return (
                <div className="flex flex-col gap-2 w-full overflow-hidden">
                    {parts.map((part, index) => {
                        // If index % 3 === 0, it's normal text
                        // If index % 3 === 1, it's language identifier (or undefined)
                        // If index % 3 === 2, it's the code
                        if (index % 3 === 0) {
                            if (!part.trim()) return null;
                            // Basic linkification for text
                             const formattedText = part.split(/(https?:\/\/[^\s]+)/g).map((chunk, i) => 
                                chunk.match(/https?:\/\/[^\s]+/) ? 
                                <a key={i} href={chunk} target="_blank" className="text-indigo-600 hover:underline break-all">{chunk}</a> : 
                                chunk
                            );
                            return <div key={index} className="whitespace-pre-wrap font-sans leading-7">{formattedText}</div>;
                        }
                        if (index % 3 === 1) return null; // Skip rendering the lang string directly, handled in next step
                        if (index % 3 === 2) {
                            const lang = parts[index - 1] || 'text';
                            return <CodeBlock key={index} language={lang} code={part} />;
                        }
                    })}
                </div>
            );
          };

          return (
              <div className={`flex w-full mb-6 ${isUser ? 'justify-end' : 'justify-start'} animate-fade-in group`}>
                  <div className={`flex w-full md:max-w-[85%] ${isUser ? 'flex-row-reverse' : 'flex-row'} gap-4`}>
                      {!isUser && (
                          <div className="w-8 h-8 rounded-full bg-white border border-slate-200 flex items-center justify-center flex-shrink-0 text-indigo-600 shadow-sm mt-1">
                              <SparklesIcon className="w-4 h-4" />
                          </div>
                      )}
                      
                      <div className={`flex-1 min-w-0 ${
                          isUser 
                          ? 'bg-indigo-600 text-white px-5 py-3 rounded-[20px] rounded-tr-sm shadow-md text-[15px]' 
                          : 'text-slate-800 pt-1'
                      }`}>
                          {renderContent()}
                      </div>
                  </div>
              </div>
          );
      };

      const SuggestionCard = ({ icon: Icon, text, onClick }) => (
        <button 
            onClick={onClick}
            className="flex flex-col items-start justify-between p-4 bg-white border border-slate-200 hover:bg-slate-50 hover:border-indigo-200 rounded-xl transition-all duration-200 text-left h-28 shadow-sm hover:shadow-md group w-full"
        >
            <div className="bg-slate-100 p-2 rounded-lg text-slate-600 group-hover:bg-indigo-50 group-hover:text-indigo-600 transition-colors">
                <Icon className="w-5 h-5" />
            </div>
            <span className="text-sm font-medium text-slate-700 group-hover:text-slate-900 line-clamp-2">{text}</span>
        </button>
      );

      const App = () => {
          const [input, setInput] = useState('');
          const [sessions, setSessions] = useState([{ id: '1', title: 'New Chat', messages: [] }]);
          const [activeId, setActiveId] = useState('1');
          const [isSidebarOpen, setIsSidebarOpen] = useState(window.innerWidth > 1024);
          const [isStreaming, setIsStreaming] = useState(false);
          const [isLoggedIn, setIsLoggedIn] = useState(false);
          const [selectedImage, setSelectedImage] = useState(null);
          const [isListening, setIsListening] = useState(false);
          
          const chatRef = useRef(null);
          const inputRef = useRef(null);
          const fileInputRef = useRef(null);
          
          const currentSession = sessions.find(s => s.id === activeId) || sessions[0];

          // Auto-resize textarea
          useEffect(() => {
            if (inputRef.current) {
                inputRef.current.style.height = 'auto';
                inputRef.current.style.height = Math.min(inputRef.current.scrollHeight, 150) + 'px';
            }
          }, [input]);

          // Scroll to bottom on new message
          useEffect(() => {
            if (chatRef.current) {
                chatRef.current.scrollTop = chatRef.current.scrollHeight;
            }
          }, [currentSession.messages, isStreaming]);

          const createSession = () => {
              const id = Date.now().toString();
              setSessions(prev => [{ id, title: 'New Chat', messages: [] }, ...prev]);
              setActiveId(id);
              if (window.innerWidth < 1024) setIsSidebarOpen(false);
          };

          const handleFileChange = (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onloadend = () => setSelectedImage(reader.result);
                reader.readAsDataURL(file);
            }
          };

          const handleVoiceInput = () => {
              if (isListening) {
                  setIsListening(false);
                  return;
              }

              // Check browser support
              const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
              if (!SpeechRecognition) {
                  alert("Voice input is not supported in this browser. Please try Chrome or Safari.");
                  return;
              }

              const recognition = new SpeechRecognition();
              recognition.lang = 'en-US';
              recognition.interimResults = false;
              recognition.maxAlternatives = 1;
              recognition.continuous = false; // Stop after one sentence for stability

              recognition.onstart = () => {
                  setIsListening(true);
              };

              recognition.onend = () => {
                  setIsListening(false);
              };

              recognition.onresult = (event) => {
                  const transcript = event.results[0][0].transcript;
                  setInput((prev) => prev ? prev + ' ' + transcript : transcript);
                  if(inputRef.current) inputRef.current.focus();
              };

              recognition.onerror = (event) => {
                  console.error("Speech recognition error", event.error);
                  setIsListening(false);
                  if (event.error === 'not-allowed') {
                      alert("Microphone access was blocked. Please allow microphone permissions in your browser settings (usually the lock icon in the address bar). \n\nIMPORTANT: Voice input requires a secure HTTPS connection.");
                  } else if (event.error === 'no-speech') {
                      // Ignore silence errors
                  } else {
                      alert("Voice Error: " + event.error);
                  }
              };

              try {
                recognition.start();
              } catch (e) {
                console.error("Failed to start recognition", e);
                setIsListening(false);
              }
          };


          const handleSend = async (textOverride = null) => {
              const textToSend = textOverride || input;
              if ((!textToSend.trim() && !selectedImage) || isStreaming) return;
              
              const imagePayload = selectedImage;
              setInput('');
              setSelectedImage(null);
              setIsStreaming(true);
              
              if (inputRef.current) inputRef.current.style.height = 'auto';

              // User Message
              let userMsgContent;
              if (imagePayload) {
                  userMsgContent = [
                      { type: 'text', text: textToSend },
                      { type: 'image_url', image_url: { url: imagePayload } }
                  ];
              } else {
                  userMsgContent = textToSend;
              }
              
              const userMsg = { role: 'user', content: userMsgContent };
              
              // Update History
              let newTitle = currentSession.title;
              if (currentSession.messages.length === 0) {
                  newTitle = textToSend ? textToSend.substring(0, 30) : 'Image Analysis';
              }

              let updatedSessions = sessions.map(s => 
                  s.id === activeId 
                  ? { ...s, messages: [...s.messages, userMsg], title: newTitle } 
                  : s
              );
              setSessions(updatedSessions);

              // API Context
              const history = currentSession.messages.map(m => ({ role: m.role, content: m.content }));
              const apiContent = [];
              if (textToSend) apiContent.push({ type: "text", text: textToSend });
              if (imagePayload) apiContent.push({ type: "image_url", image_url: { url: imagePayload } });
              history.push({ role: 'user', content: apiContent });
              
              const systemMsg = { 
                  role: 'system', 
                  content: `You are Bapkam, a highly intelligent AI created by P ARAVIND from India, Telangana, Narayanapet.
                  
                  YOUR CODING GUIDELINES (CRITICAL):
                  - When asked for code, provide ONLY production-ready, error-free code.
                  - Use Markdown code blocks (e.g., \`\`\`python) for ALL code.
                  - Include comments explaining complex logic.
                  - Ensure Python code follows PEP 8 standards.
                  - If writing a web app, include both HTML and JS if needed.
                  
                  Be concise, smart, and friendly.` 
              };
              
              updatedSessions = updatedSessions.map(s => 
                  s.id === activeId ? { ...s, messages: [...s.messages, { role: 'assistant', content: '' }] } : s
              );
              setSessions(updatedSessions);

              try {
                  const response = await fetch(API_URL, {
                      method: 'POST',
                      headers: {
                          'Authorization': `Bearer ${API_KEY}`,
                          'Content-Type': 'application/json',
                          'HTTP-Referer': window.location.href,
                          'X-Title': 'bapkam.ai',
                      },
                      body: JSON.stringify({
                          model: MODEL,
                          messages: [systemMsg, ...history],
                          stream: true
                      })
                  });

                  if (!response.ok) throw new Error('Connection error');

                  const reader = response.body.getReader();
                  const decoder = new TextDecoder();
                  let assistantText = '';

                  while (true) {
                      const { done, value } = await reader.read();
                      if (done) break;
                      const chunk = decoder.decode(value);
                      const lines = chunk.split('\n').filter(line => line.trim() !== '');
                      
                      for (const line of lines) {
                          if (line === 'data: [DONE]') break;
                          if (line.startsWith('data: ')) {
                              try {
                                  const json = JSON.parse(line.slice(6));
                                  const content = json.choices[0]?.delta?.content || '';
                                  assistantText += content;
                                  setSessions(prev => prev.map(s => {
                                      if (s.id !== activeId) return s;
                                      const newMsgs = [...s.messages];
                                      newMsgs[newMsgs.length - 1] = { role: 'assistant', content: assistantText };
                                      return { ...s, messages: newMsgs };
                                  }));
                              } catch (e) { }
                          }
                      }
                  }
              } catch (error) {
                  console.error(error);
              } finally {
                  setIsStreaming(false);
              }
          };

          // Login Screen
          if (!isLoggedIn) {
              return (
                  <div className="h-full w-full flex flex-col items-center justify-center p-6 bg-white relative overflow-hidden">
                      <div className="absolute top-0 left-0 w-96 h-96 bg-indigo-100 rounded-full blur-3xl opacity-50 -translate-x-1/2 -translate-y-1/2 animate-pulse-slow"></div>
                      <div className="absolute bottom-0 right-0 w-96 h-96 bg-pink-100 rounded-full blur-3xl opacity-50 translate-x-1/2 translate-y-1/2 animate-pulse-slow"></div>
                      
                      <div className="z-10 flex flex-col items-center text-center max-w-md w-full animate-fade-in-up">
                          <div className="w-20 h-20 mb-8 bg-white border border-slate-100 rounded-3xl shadow-xl flex items-center justify-center">
                             <SparklesIcon className="w-10 h-10 text-indigo-600" />
                          </div>
                          <h1 className="text-4xl font-bold text-slate-900 mb-2 tracking-tight">bapkam.ai</h1>
                          <p className="text-slate-500 mb-10 text-lg">Your intelligent companion.</p>
                          
                          <button 
                            onClick={() => setIsLoggedIn(true)} 
                            className="w-full group relative flex items-center justify-center gap-3 px-8 py-4 bg-slate-900 text-white rounded-2xl font-semibold shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all duration-200 overflow-hidden"
                          >
                              <span className="relative flex items-center gap-2">
                                Log in to Chat <Icon d="M5 12h14M12 5l7 7-7 7" className="w-5 h-5" />
                              </span>
                          </button>
                          <p className="mt-6 text-xs text-slate-400">By continuing, you agree to our Terms & Policy.</p>
                      </div>
                  </div>
              );
          }

          const isNewChat = currentSession.messages.length === 0;

          return (
              <div className="flex h-full w-full bg-white text-slate-900 font-sans">
                  {/* Sidebar */}
                  {isSidebarOpen && (
                      <div className="fixed inset-0 bg-black/20 z-30 lg:hidden backdrop-blur-sm" onClick={() => setIsSidebarOpen(false)}></div>
                  )}
                  <aside className={`
                      fixed lg:relative inset-y-0 left-0 w-[280px] bg-slate-50 border-r border-slate-200 z-40
                      transform transition-transform duration-300 ease-[cubic-bezier(0.25,1,0.5,1)]
                      ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'} lg:translate-x-0 flex flex-col
                  `}>
                      <div className="p-4 flex items-center justify-between">
                          <div className="flex items-center gap-2 font-bold text-lg text-slate-800">
                             <div className="w-8 h-8 bg-white border border-slate-200 rounded-lg flex items-center justify-center shadow-sm"><SparklesIcon className="w-4 h-4 text-indigo-600"/></div>
                             bapkam
                          </div>
                          <button onClick={() => setIsSidebarOpen(false)} className="lg:hidden p-2 hover:bg-slate-200 rounded-lg"><CloseIcon className="w-5 h-5"/></button>
                      </div>
                      
                      <div className="px-4 pb-4">
                          <button onClick={createSession} className="w-full flex items-center gap-3 px-4 py-3 bg-white border border-slate-200 hover:border-indigo-300 hover:shadow-sm rounded-xl transition-all text-sm font-medium text-slate-700 group">
                              <div className="bg-indigo-50 text-indigo-600 p-1 rounded-md group-hover:bg-indigo-600 group-hover:text-white transition-colors"><PlusIcon className="w-4 h-4"/></div>
                              New Chat
                          </button>
                      </div>

                      <div className="flex-1 overflow-y-auto px-2 custom-scroll">
                          <div className="text-xs font-semibold text-slate-400 px-4 py-2 uppercase tracking-wider">Recents</div>
                          {sessions.map(s => (
                              <button key={s.id} onClick={() => { setActiveId(s.id); if(window.innerWidth < 1024) setIsSidebarOpen(false); }} className={`w-full text-left px-4 py-2.5 rounded-lg text-sm truncate transition-colors mb-1 ${activeId === s.id ? 'bg-white shadow-sm text-indigo-700 font-medium' : 'text-slate-600 hover:bg-slate-100'}`}>
                                  {s.title}
                              </button>
                          ))}
                      </div>

                      <div className="p-4 border-t border-slate-200">
                          <button onClick={() => setIsLoggedIn(false)} className="flex items-center gap-3 w-full px-3 py-2 hover:bg-slate-100 rounded-lg text-sm font-medium text-slate-600 transition-colors">
                              <div className="w-8 h-8 bg-indigo-600 rounded-full text-white flex items-center justify-center text-xs font-bold">P</div>
                              <div className="flex-1 text-left">
                                  <div className="text-slate-900">User</div>
                                  <div className="text-xs text-slate-400">Pro Plan</div>
                              </div>
                              <Icon d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9" className="w-4 h-4" />
                          </button>
                      </div>
                  </aside>

                  {/* Main Content */}
                  <main className="flex-1 flex flex-col h-full relative min-w-0">
                      {/* Header */}
                      <header className="h-14 flex items-center justify-between px-4 bg-white/80 backdrop-blur-md sticky top-0 z-20 border-b border-transparent">
                          <div className="flex items-center gap-3">
                              <button onClick={() => setIsSidebarOpen(true)} className="lg:hidden p-2 hover:bg-slate-100 rounded-lg text-slate-600"><MenuIcon className="w-6 h-6"/></button>
                              <span className="font-semibold text-slate-700 lg:hidden">bapkam.ai</span>
                              <div className="hidden lg:flex items-center gap-2 px-3 py-1 bg-slate-100 rounded-full border border-slate-200">
                                <span className="w-2 h-2 rounded-full bg-green-500"></span>
                                <span className="font-medium text-slate-600 text-xs">Gemini 2.0 Flash</span>
                              </div>
                          </div>
                      </header>

                      {/* Chat Area */}
                      <div className="flex-1 overflow-y-auto custom-scroll scroll-smooth" ref={chatRef}>
                          {isNewChat ? (
                              <div className="max-w-3xl mx-auto px-6 pt-10 pb-10 flex flex-col items-center animate-fade-in-up">
                                  <div className="mb-6 p-4 bg-white rounded-full shadow-sm border border-slate-100">
                                      <SparklesIcon className="w-8 h-8 text-indigo-600" />
                                  </div>
                                  <h2 className="text-2xl md:text-3xl font-semibold text-slate-900 mb-2 text-center">{getTimeBasedGreeting()}, User</h2>
                                  <p className="text-slate-500 mb-10 text-center">I can help you write code, analyze images, or just chat.</p>
                                  
                                  <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 w-full max-w-2xl">
                                      <SuggestionCard icon={ImageUploadIcon} text="Analyze an image" onClick={() => fileInputRef.current.click()} />
                                      <SuggestionCard icon={CodeIcon} text="Write a Python script" onClick={() => handleSend("Write a comprehensive Python script for a To-Do list app with JSON saving.")} />
                                      <SuggestionCard icon={SearchIcon} text="Explain Quantum Computing" onClick={() => handleSend("Explain Quantum Computing in simple terms.")} />
                                      <SuggestionCard icon={SparklesIcon} text="Write a Story" onClick={() => handleSend("Write a short sci-fi story about a robot learning to paint.")} />
                                  </div>
                              </div>
                          ) : (
                              <div className="max-w-3xl mx-auto px-4 py-6">
                                  {currentSession.messages.map((m, i) => <ChatMessage key={i} msg={m} />)}
                                  {isStreaming && (
                                      <div className="flex justify-start w-full mb-6 animate-fade-in pl-12">
                                          <div className="flex gap-1 items-center h-8">
                                              <div className="w-2 h-2 bg-slate-400 rounded-full animate-bounce"></div>
                                              <div className="w-2 h-2 bg-slate-400 rounded-full animate-bounce [animation-delay:0.2s]"></div>
                                              <div className="w-2 h-2 bg-slate-400 rounded-full animate-bounce [animation-delay:0.4s]"></div>
                                          </div>
                                      </div>
                                  )}
                              </div>
                          )}
                      </div>

                      {/* Input Area */}
                      <div className="p-4 bg-white">
                          <div className="max-w-3xl mx-auto relative">
                              {selectedImage && (
                                  <div className="absolute bottom-full left-0 mb-4 p-2 bg-white border border-slate-200 rounded-xl shadow-lg animate-fade-in z-10">
                                      <img src={selectedImage} alt="Preview" className="h-24 rounded-lg" />
                                      <button onClick={() => setSelectedImage(null)} className="absolute -top-2 -right-2 bg-slate-800 text-white rounded-full p-1 shadow-md hover:bg-slate-900"><CloseIcon className="w-3 h-3"/></button>
                                  </div>
                              )}

                              <div className={`
                                  flex items-end gap-2 p-2 bg-slate-50 border border-slate-200 rounded-[26px] shadow-sm 
                                  focus-within:ring-2 focus-within:ring-indigo-500/10 focus-within:border-indigo-400 
                                  focus-within:bg-white transition-all duration-200
                              `}>
                                  <input type="file" ref={fileInputRef} onChange={handleFileChange} className="hidden" accept="image/*" />
                                  <button 
                                      onClick={() => fileInputRef.current.click()}
                                      className="p-3 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-full transition-colors flex-shrink-0"
                                      title="Upload Image"
                                  >
                                      <PlusIcon className="w-6 h-6" />
                                  </button>

                                  <textarea
                                      ref={inputRef}
                                      value={input}
                                      onChange={(e) => setInput(e.target.value)}
                                      onKeyDown={(e) => { if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSend(); } }}
                                      placeholder="Message Bapkam..."
                                      className="flex-1 bg-transparent border-none outline-none text-slate-800 placeholder:text-slate-400 py-3 max-h-32 resize-none font-sans text-[15px]"
                                      rows={1}
                                  />

                                  {/* Voice Input Button */}
                                  <button
                                      onClick={handleVoiceInput}
                                      className={`
                                          p-3 rounded-full flex-shrink-0 transition-all duration-200
                                          ${isListening ? 'bg-red-100 text-red-600 animate-pulse-fast' : 'text-slate-400 hover:text-indigo-600 hover:bg-indigo-50'}
                                      `}
                                      title="Voice Input"
                                  >
                                      <MicIcon className="w-5 h-5" />
                                  </button>

                                  <button 
                                      onClick={() => handleSend()}
                                      disabled={!input.trim() && !selectedImage}
                                      className={`
                                          p-3 rounded-full flex-shrink-0 transition-all duration-200
                                          ${(input.trim() || selectedImage) 
                                              ? 'bg-slate-900 text-white shadow-md hover:bg-black transform hover:scale-105' 
                                              : 'bg-slate-200 text-slate-400 cursor-not-allowed'}
                                      `}
                                  >
                                      <SendIcon className="w-5 h-5" />
                                  </button>
                              </div>
                              <div className="text-center mt-2">
                                  <p className="text-[10px] text-slate-400">AI can make mistakes. Check important info.</p>
                              </div>
                          </div>
                      </div>
                  </main>
              </div>
          );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>